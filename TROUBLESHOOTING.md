# 语音命令识别系统问题解决指南

## 常见问题及解决方案

### 1. 系统无法唤醒

**问题现象**：
- 对着麦克风说"你好小智"没有反应
- 串口持续显示"等待唤醒词 '你好小智'"

**解决方案**：
1. 检查麦克风接线是否正确
2. 确认唤醒词模型已正确配置：
   ```bash
   idf.py menuconfig
   ```
   进入 `ESP Speech Recognition` → `Load Multiple Wake Words` 确认选择了正确的唤醒词模型

3. 检查环境噪音，尝试在安静环境下测试
4. 调整检测灵敏度，在 `main/main.cc` 中修改检测模式：
   ```c
   model_iface_data_t *model_data = wakenet->create(model_name, DET_MODE_80);  // 从90改为80
   ```

### 2. 无法连接到WiFi

**问题现象**：
- 串口显示"❌ WiFi连接失败"
- 无法获取IP地址

**解决方案**：
1. 检查 `main/project_config.h` 中的WiFi配置是否正确：
   ```c
   #define CONFIG_EXAMPLE_WIFI_SSID "正确的WiFi名称"
   #define CONFIG_EXAMPLE_WIFI_PASSWORD "正确的WiFi密码"
   ```

2. 确认WiFi路由器工作正常，设备可正常连接
3. 检查ESP32开发板是否正常供电
4. 尝试重启路由器和开发板

### 3. WebSocket连接失败

**问题现象**：
- 串口显示"❌ WebSocket连接失败"
- 系统无法与语音服务器通信

**解决方案**：
1. 检查 `main/project_config.h` 中的服务器地址配置：
   ```c
   #define CONFIG_EXAMPLE_WEBSOCKET_URI "ws://正确的服务器IP:8888"
   ```

2. 确认语音服务器正在运行：
   ```bash
   python simple_fixed_server.py
   ```

3. 检查服务器IP地址是否正确，ESP32和服务器是否在同一网络中
4. 检查防火墙设置，确保8888端口未被阻止
5. 尝试在浏览器中访问 `http://服务器IP:8888` 确认端口开放

### 4. 没有声音输出

**问题现象**：
- 系统连接正常但听不到AI回应的声音
- 串口有数据传输但喇叭无声

**解决方案**：
1. 检查功放和喇叭的接线是否正确
2. 确认喇叭连接到功放的+/-端子
3. 检查3.3V供电是否稳定
4. 用万用表测试功放VIN端是否有3.3V电压
5. 尝试更换喇叭测试

### 5. 音频质量差或有杂音

**问题现象**：
- 播放的AI语音有杂音或断断续续
- 音频质量不如预期

**解决方案**：
1. 确保服务器端已安装scipy库以获得高质量重采样：
   ```bash
   pip install scipy numpy
   ```

2. 检查网络连接稳定性，确保WiFi信号良好
3. 降低环境噪音，避免麦克风录入干扰音
4. 检查电源供电是否稳定，不稳定的电源可能导致音频噪声

### 6. 系统频繁重启或死机

**问题现象**：
- 系统运行一段时间后自动重启
- 程序无响应或卡死

**解决方案**：
1. 检查开发板是否为ESP32-S3且带PSRAM
2. 确认USB供电充足（建议使用电脑USB 3.0口）
3. 查看串口日志中的错误信息
4. 检查内存使用情况，避免内存泄漏
5. 确认所有外设连接正确，没有短路现象

### 7. 唤醒词误触发

**问题现象**：
- 没有说话时系统也会被唤醒
- 环境噪音导致误触发

**解决方案**：
1. 提高检测严格度，在 `main/main.cc` 中修改检测模式：
   ```c
   model_iface_data_t *model_data = wakenet->create(model_name, DET_MODE_95);  // 从90改为95
   ```

2. 选择更独特的唤醒词减少误触发
3. 改善使用环境，减少背景噪音

## 服务器端问题

### 1. 豆包API连接失败

**问题现象**：
- 服务器日志显示无法连接到豆包API
- 提示API密钥错误

**解决方案**：
1. 检查 `simple_fixed_server.py` 中的API密钥配置是否正确
2. 确认已获得豆包API访问权限
3. 检查网络连接，确保可访问豆包API服务器

### 2. 音频重采样问题

**问题现象**：
- AI回应的音频播放速度异常
- 音调不正确

**解决方案**：
1. 确保服务器端已安装scipy和numpy库：
   ```bash
   pip install scipy numpy
   ```

2. 检查服务器日志中的重采样信息
3. 确认ESP32和豆包API的音频采样率配置正确

## 调试技巧

### 1. 查看串口输出
使用以下命令查看ESP32的串口输出：
```bash
idf.py monitor
```

### 2. 检查服务器日志
运行服务器时查看输出日志，确认连接状态和数据传输情况：
```bash
python simple_fixed_server.py
```

### 3. 网络诊断
- 使用ping命令确认ESP32和服务器网络连通性
- 使用telnet或nc命令测试8888端口是否开放：
  ```bash
  telnet 服务器IP 8888
  ```

### 4. 硬件测试
- 使用万用表检查电源电压
- 检查各模块之间的连接是否牢固
- 尝试单独测试麦克风和功放模块

## 获取帮助

如果以上解决方案都无法解决问题，请：
1. 详细记录错误现象和日志信息
2. 检查硬件连接是否正确
3. 确认软件版本是否兼容
4. 在相关技术论坛或社区寻求帮助