/**
 * @file bsp_board.h
 * @brief ğŸ® BSPï¼ˆBoard Support Packageï¼‰æ¿çº§æ”¯æŒåŒ… - ç¡¬ä»¶æŠ½è±¡å±‚
 * 
 * è¿™ä¸ªæ–‡ä»¶å°±åƒâ€œç¡¬ä»¶è¯´æ˜ä¹¦â€ï¼Œå®šä¹‰äº†æ“ä½œéŸ³é¢‘ç¡¬ä»¶çš„å„ç§å‡½æ•°ã€‚
 * 
 * ğŸ¯ æ”¯æŒçš„ç¡¬ä»¶ï¼š
 * - ğŸ¤ INMP441æ•°å­—éº¦å…‹é£ï¼ˆé«˜æ¸…å½•éŸ³ï¼‰
 * - ğŸ”Š MAX98357Aæ•°å­—åŠŸæ”¾ï¼ˆæ¸…æ™°æ’­æ”¾ï¼‰
 * - ğŸ“Ÿï¸ ESP32-S3å¼€å‘æ¿ï¼ˆä¸»æ§èŠ¯ç‰‡ï¼‰
 * 
 * ğŸ”Œ ä¸»è¦åŠŸèƒ½ï¼š
 * 1. åˆå§‹åŒ–éŸ³é¢‘è¾“å…¥è¾“å‡º
 * 2. ä»éº¦å…‹é£è¯»å–å£°éŸ³
 * 3. é€šè¿‡æ‰¬å£°å™¨æ’­æ”¾å£°éŸ³
 * 4. ç®¡ç†I2Sæ€»çº¿é€šä¿¡
 * 
 * @copyright Copyright 2021 Espressif Systems (Shanghai) Co. Ltd.
 *      Licensed under the Apache License, Version 2.0
 */

#pragma once

#include <stdbool.h>
#include "esp_err.h"
#include "freertos/FreeRTOS.h"

#ifdef __cplusplus
extern "C" {
#endif

/**
 * @brief ğŸš€ åˆå§‹åŒ–å¼€å‘æ¿éŸ³é¢‘ç¡¬ä»¶
 *
 * è¿™æ˜¯ä½¿ç”¨éŸ³é¢‘åŠŸèƒ½å‰å¿…é¡»è°ƒç”¨çš„å‡½æ•°ï¼Œå®ƒä¼šï¼š
 * 1. åˆå§‹åŒ–INMP441éº¦å…‹é£
 * 2. è®¾ç½®å¥½I2Sé€šä¿¡åè®®
 * 3. å‡†å¤‡å¥½æ‰€æœ‰éŸ³é¢‘ç›¸å…³çš„GPIOå¼•è„š
 *
 * @param sample_rate é‡‡æ ·ç‡ï¼ˆæ¨è16000Hzï¼Œé€‚åˆè¯­éŸ³è¯†åˆ«ï¼‰
 * @param channel_format å£°é“æ•°ï¼ˆ1=å•å£°é“ï¼Œ2=ç«‹ä½“å£°ï¼‰
 * @param bits_per_chan é‡‡æ ·ä½æ•°ï¼ˆ16ä½=CDéŸ³è´¨ï¼Œ32ä½=æ›´é«˜ç²¾åº¦ï¼‰
 * @return
 *    - ESP_OK: âœ… åˆå§‹åŒ–æˆåŠŸ
 *    - å…¶ä»–å€¼: âŒ åˆå§‹åŒ–å¤±è´¥
 */
esp_err_t bsp_board_init(uint32_t sample_rate, int channel_format, int bits_per_chan);

/**
 * @brief ğŸ¤ ä»éº¦å…‹é£è·å–å£°éŸ³æ•°æ®
 *
 * è¿™ä¸ªå‡½æ•°å°±åƒâ€œå½•éŸ³â€ï¼Œè®©æ‚¨èƒ½å¤Ÿï¼š
 * - è¯»å–éº¦å…‹é£æ•æ‰åˆ°çš„å£°éŸ³
 * - è·å¾—å¯ä»¥ç”¨äºè¯­éŸ³è¯†åˆ«çš„æ•°æ®
 * - æŒ‰ç…§éœ€è¦çš„é•¿åº¦è¯»å–æ•°æ®
 *
 * @param is_get_raw_channel æ˜¯å¦è·å–åŸå§‹æ•°æ®ï¼ˆtrue=ä¸å¤„ç†ï¼Œfalse=ç»è¿‡ä¼˜åŒ–ï¼‰
 * @param buffer å­˜å‚¨éŸ³é¢‘æ•°æ®çš„æ•°ç»„ï¼ˆæ‚¨æä¾›çš„â€œå½•éŸ³å¸¦â€ï¼‰
 * @param buffer_len æ•°ç»„å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰
 * @return
 *    - ESP_OK: âœ… è¯»å–æˆåŠŸ
 *    - å…¶ä»–å€¼: âŒ è¯»å–å¤±è´¥
 */
esp_err_t bsp_get_feed_data(bool is_get_raw_channel, int16_t *buffer, int buffer_len);

/**
 * @brief ğŸµ è·å–éŸ³é¢‘è¾“å…¥çš„å£°é“æ•°
 *
 * å‘Šè¯‰æ‚¨éº¦å…‹é£æ˜¯å•å£°é“è¿˜æ˜¯ç«‹ä½“å£°ã€‚
 * ç›®å‰æˆ‘ä»¬ä½¿ç”¨å•å£°é“ï¼ŒèŠ‚çœå†…å­˜å’Œå¤„ç†æ—¶é—´ã€‚
 *
 * @return å£°é“æ•°ï¼ˆ1=å•å£°é“ï¼Œ2=ç«‹ä½“å£°ï¼‰
 */
int bsp_get_feed_channel(void);

/**
 * @brief ğŸ”Š åˆå§‹åŒ–éŸ³é¢‘æ’­æ”¾åŠŸèƒ½
 *
 * è¿™ä¸ªå‡½æ•°ä¸“é—¨ä¸ºæ’­æ”¾éŸ³é¢‘åšå‡†å¤‡ï¼Œå®ƒä¼šï¼š
 * 1. åˆå§‹åŒ–MAX98357AåŠŸæ”¾
 * 2. è®¾ç½®å¥½éŸ³é¢‘è¾“å‡ºé€šé“
 * 3. å‡†å¤‡å¥½æ‰¬å£°å™¨æ¥å£
 *
 * @param sample_rate é‡‡æ ·ç‡ï¼ˆæ¨è16000Hzï¼Œä¸å½•éŸ³ä¿æŒä¸€è‡´ï¼‰
 * @param channel_format å£°é“æ•°ï¼ˆ1=å•å£°é“ï¼Œ2=ç«‹ä½“å£°ï¼‰
 * @param bits_per_chan é‡‡æ ·ä½æ•°ï¼ˆ16ä½=æ ‡å‡†éŸ³è´¨ï¼‰
 * @return
 *    - ESP_OK: âœ… åˆå§‹åŒ–æˆåŠŸ
 *    - å…¶ä»–å€¼: âŒ åˆå§‹åŒ–å¤±è´¥
 */
esp_err_t bsp_audio_init(uint32_t sample_rate, int channel_format, int bits_per_chan);

/**
 * @brief ğŸµ æ’­æ”¾éŸ³é¢‘æ•°æ®
 *
 * è¿™ä¸ªå‡½æ•°å°±åƒâ€œæ’­æ”¾å™¨â€ï¼Œå®ƒä¼šï¼š
 * - æŠŠæ‚¨æä¾›çš„éŸ³é¢‘æ•°æ®å‘é€ç»™æ‰¬å£°å™¨
 * - æ’­æ”¾å®Œåè‡ªåŠ¨åœæ­¢ï¼ˆé¿å…å™ªéŸ³ï¼‰
 * - é€‚åˆæ’­æ”¾å®Œæ•´çš„éŸ³é¢‘æ–‡ä»¶
 *
 * @param audio_data éŸ³é¢‘æ•°æ®çš„å†…å­˜åœ°å€ï¼ˆPCMæ ¼å¼ï¼‰
 * @param data_len éŸ³é¢‘æ•°æ®çš„å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰
 * @return
 *    - ESP_OK: âœ… æ’­æ”¾æˆåŠŸ
 *    - å…¶ä»–å€¼: âŒ æ’­æ”¾å¤±è´¥
 */
esp_err_t bsp_play_audio(const uint8_t *audio_data, size_t data_len);

/**
 * @brief ğŸŒŠ æµå¼æ’­æ”¾éŸ³é¢‘æ•°æ®
 *
 * è¿™ä¸ªå‡½æ•°ç‰¹åˆ«ä¸ºâ€œè¾¹ä¸‹è½½è¾¹æ’­æ”¾â€è®¾è®¡ï¼š
 * - æ’­æ”¾å®Œåä¸ä¼šåœæ­¢I2S
 * - å¯ä»¥è¿ç»­æ’­æ”¾å¤šä¸ªéŸ³é¢‘ç‰‡æ®µ
 * - é€‚åˆå®æ—¶æµåª’ä½“åœºæ™¯
 *
 * @param audio_data éŸ³é¢‘æ•°æ®çš„å†…å­˜åœ°å€ï¼ˆPCMæ ¼å¼ï¼‰
 * @param data_len éŸ³é¢‘æ•°æ®çš„å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰
 * @return
 *    - ESP_OK: âœ… æ’­æ”¾æˆåŠŸ
 *    - å…¶ä»–å€¼: âŒ æ’­æ”¾å¤±è´¥
 */
esp_err_t bsp_play_audio_stream(const uint8_t *audio_data, size_t data_len);

/**
 * @brief ğŸ›‘ï¸ åœæ­¢éŸ³é¢‘è¾“å‡º
 *
 * è¿™ä¸ªå‡½æ•°å¯ä»¥ï¼š
 * - ç«‹å³åœæ­¢éŸ³é¢‘æ’­æ”¾
 * - æ¶ˆé™¤æ‰¬å£°å™¨çš„å™ªéŸ³
 * - å…³é—­åŠŸæ”¾èŠ‚çœç”µé‡
 *
 * @return
 *    - ESP_OK: âœ… åœæ­¢æˆåŠŸ
 *    - å…¶ä»–å€¼: âŒ åœæ­¢å¤±è´¥
 */
esp_err_t bsp_audio_stop(void);

#ifdef __cplusplus
}
#endif
